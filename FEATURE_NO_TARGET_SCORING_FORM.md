# HÆ°á»›ng dáº«n sá»­ dá»¥ng Form cháº¥m Ä‘iá»ƒm cho Ä‘Æ¡n vá»‹ khÃ´ng Ä‘Æ°á»£c giao chá»‰ tiÃªu

## ğŸ“‹ Tá»•ng quan

Form cháº¥m Ä‘iá»ƒm Ä‘á»‹nh lÆ°á»£ng Ä‘Ã£ Ä‘Æ°á»£c cáº­p nháº­t Ä‘á»ƒ há»— trá»£ **Ä‘Æ¡n vá»‹ khÃ´ng Ä‘Æ°á»£c giao chá»‰ tiÃªu**. NgÆ°á»i dÃ¹ng cÃ³ thá»ƒ Ä‘Ã¡nh dáº¥u báº±ng checkbox vÃ  chá»‰ cáº§n nháº­p káº¿t quáº£ thá»±c hiá»‡n.

---

## ğŸ¯ CÃ¡ch sá»­ dá»¥ng

### **TrÆ°á»ng há»£p 1: ÄÆ¡n vá»‹ ÄÆ¯á»¢C GIAO chá»‰ tiÃªu (bÃ¬nh thÆ°á»ng)**

1. **Má»Ÿ form cháº¥m Ä‘iá»ƒm** cho tiÃªu chÃ­ Ä‘á»‹nh lÆ°á»£ng
2. **Nháº­p chá»‰ tiÃªu Ä‘Æ°á»£c giao** (vÃ­ dá»¥: 100)
3. **Nháº­p káº¿t quáº£ thá»±c hiá»‡n** (vÃ­ dá»¥: 120)
4. **Xem Ä‘iá»ƒm dá»± kiáº¿n** hiá»ƒn thá»‹ tá»± Ä‘á»™ng
5. **Click "LÆ°u Ä‘iá»ƒm"**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TiÃªu chÃ­ Ä‘á»‹nh lÆ°á»£ng                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜ ÄÆ¡n vá»‹ khÃ´ng Ä‘Æ°á»£c giao chá»‰ tiÃªu          â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ Chá»‰ tiÃªu Ä‘Æ°á»£c giao *  â”‚ Káº¿t quáº£ thá»±c hiá»‡n * â”‚
â”‚ [    100    ]         â”‚ [     120      ]    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â„¹ Äiá»ƒm dá»± kiáº¿n: 10.0 / 10 (Tá»· lá»‡: 120.0%)  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

### **TrÆ°á»ng há»£p 2: ÄÆ¡n vá»‹ KHÃ”NG ÄÆ¯á»¢C GIAO chá»‰ tiÃªu**

1. **Má»Ÿ form cháº¥m Ä‘iá»ƒm** cho tiÃªu chÃ­ Ä‘á»‹nh lÆ°á»£ng
2. **âœ… Check vÃ o checkbox** "ÄÆ¡n vá»‹ khÃ´ng Ä‘Æ°á»£c giao chá»‰ tiÃªu"
3. **Input chá»‰ tiÃªu sáº½ tá»± Ä‘á»™ng áº©n Ä‘i**
4. **Nháº­p káº¿t quáº£ thá»±c hiá»‡n** (vÃ­ dá»¥: 150)
5. **Badge "KhÃ´ng giao CT" sáº½ hiá»ƒn thá»‹** vá»›i hÆ°á»›ng dáº«n
6. **Click "LÆ°u Ä‘iá»ƒm"**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TiÃªu chÃ­ Ä‘á»‹nh lÆ°á»£ng                         â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â˜‘ ÄÆ¡n vá»‹ khÃ´ng Ä‘Æ°á»£c giao chá»‰ tiÃªu          â”‚
â”‚   Chá»‰ nháº­p káº¿t quáº£ thá»±c hiá»‡n. Äiá»ƒm sáº½ tÃ­nh â”‚
â”‚   theo tá»· lá»‡ so vá»›i Ä‘Æ¡n vá»‹ cÃ³ káº¿t quáº£ cao  â”‚
â”‚   nháº¥t cÃ¹ng nhÃ³m.                           â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚         Káº¿t quáº£ thá»±c hiá»‡n *                 â”‚
â”‚         [     150      ]                    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ğŸ”µ KhÃ´ng giao CT                            â”‚
â”‚ Äiá»ƒm sáº½ Ä‘Æ°á»£c tÃ­nh tá»± Ä‘á»™ng theo tá»· lá»‡ so vá»›iâ”‚
â”‚ Ä‘Æ¡n vá»‹ cÃ³ káº¿t quáº£ cao nháº¥t trong nhÃ³m khÃ´ngâ”‚
â”‚ Ä‘Æ°á»£c giao chá»‰ tiÃªu (tá»‘i Ä‘a 100% Ä‘iá»ƒm).     â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

---

## ğŸ¨ Giao diá»‡n má»›i

### **Before (khÃ´ng check checkbox)**

<img src="form-with-target.png" alt="Form cÃ³ chá»‰ tiÃªu" />

- Hiá»ƒn thá»‹ 2 input: **Chá»‰ tiÃªu Ä‘Æ°á»£c giao** vÃ  **Káº¿t quáº£ thá»±c hiá»‡n**
- Grid layout 2 cá»™t
- Hiá»ƒn thá»‹ Ä‘iá»ƒm dá»± kiáº¿n vÃ  cÃ´ng thá»©c tÃ­nh

### **After (check checkbox)**

<img src="form-no-target.png" alt="Form khÃ´ng cÃ³ chá»‰ tiÃªu" />

- **Checkbox** Ä‘Æ°á»£c check âœ…
- Input chá»‰ tiÃªu **tá»± Ä‘á»™ng áº©n**
- Input káº¿t quáº£ **full width** (chiáº¿m cáº£ 2 cá»™t)
- **Badge "KhÃ´ng giao CT"** hiá»ƒn thá»‹ mÃ u xanh
- **HÆ°á»›ng dáº«n** rÃµ rÃ ng vá» cÃ¡ch tÃ­nh Ä‘iá»ƒm

---

## ğŸ”§ Chi tiáº¿t ká»¹ thuáº­t

### **State Management**

```typescript
const [noTarget, setNoTarget] = useState(false); // Checkbox state
const [targetValue, setTargetValue] = useState(""); // Target input
const [actualValue, setActualValue] = useState(""); // Actual input
```

### **Auto-detect existing no-target units**

Khi má»Ÿ form cho Ä‘Æ¡n vá»‹ Ä‘Ã£ cÃ³ dá»¯ liá»‡u (edit mode):

```typescript
useEffect(() => {
  if (open && criteriaType === 1) {
    // Auto-check checkbox if currentTargetValue is 0 or null
    setNoTarget(!currentTargetValue || currentTargetValue === 0);
  }
}, [open, currentTargetValue]);
```

### **Validation Logic**

```typescript
if (noTarget) {
  // Only validate actual value
  if (!actualValue || parseFloat(actualValue) < 0) {
    errors.actualValue = "Vui lÃ²ng nháº­p káº¿t quáº£ thá»±c hiá»‡n (â‰¥ 0)";
  }
  
  // Save with targetValue = 0
  onSave({
    targetValue: 0,
    actualValue: parseFloat(actualValue),
    file: file || undefined,
  });
} else {
  // Normal validation: both target and actual
  // ...
}
```

### **UI Behavior**

| Action | Result |
|--------|--------|
| Check "KhÃ´ng giao CT" | - Target input **áº©n**<br>- Actual input **full width**<br>- Badge **hiá»ƒn thá»‹**<br>- CÃ´ng thá»©c **áº©n** |
| Uncheck "KhÃ´ng giao CT" | - Target input **hiá»‡n**<br>- Grid **2 cá»™t**<br>- Badge **áº©n**<br>- CÃ´ng thá»©c **hiá»ƒn thá»‹** |

---

## ğŸ“Š Luá»“ng dá»¯ liá»‡u

```mermaid
graph TD
    A[Má»Ÿ form] --> B{Check "KhÃ´ng giao CT"?}
    B -->|Yes| C[targetValue = 0]
    B -->|No| D[Nháº­p target > 0]
    C --> E[Nháº­p actual]
    D --> E
    E --> F[Click LÆ°u]
    F --> G{noTarget?}
    G -->|Yes| H[Backend: NhÃ³m 2 - TÃ­nh theo ratio]
    G -->|No| I[Backend: NhÃ³m 1 - TÃ­nh theo exceed%]
    H --> J[Hiá»ƒn thá»‹ badge trÃªn báº£ng]
    I --> J
```

---

## âœ… Validation Rules

### **Khi KHÃ”NG check "KhÃ´ng giao CT"**
- âœ… **Chá»‰ tiÃªu**: Báº¯t buá»™c, > 0
- âœ… **Káº¿t quáº£**: Báº¯t buá»™c, â‰¥ 0

### **Khi CHECK "KhÃ´ng giao CT"**
- â­ï¸ **Chá»‰ tiÃªu**: Skip validation (auto = 0)
- âœ… **Káº¿t quáº£**: Báº¯t buá»™c, â‰¥ 0

---

## ğŸ¯ Test Cases

### Test Case 1: Check/Uncheck checkbox

**Steps:**
1. Má»Ÿ form cháº¥m Ä‘iá»ƒm Ä‘á»‹nh lÆ°á»£ng
2. Check "KhÃ´ng giao CT"
3. **Expected**: Input chá»‰ tiÃªu áº©n, badge hiá»ƒn thá»‹
4. Uncheck "KhÃ´ng giao CT"
5. **Expected**: Input chá»‰ tiÃªu hiá»‡n láº¡i

### Test Case 2: LÆ°u Ä‘Æ¡n vá»‹ khÃ´ng cÃ³ target

**Steps:**
1. Check "KhÃ´ng giao CT"
2. Nháº­p actual = 150
3. Click "LÆ°u Ä‘iá»ƒm"
4. **Expected**: LÆ°u thÃ nh cÃ´ng vá»›i targetValue = 0
5. Xem báº£ng Ä‘iá»ƒm
6. **Expected**: Hiá»ƒn thá»‹ badge "KhÃ´ng giao CT"

### Test Case 3: Edit Ä‘Æ¡n vá»‹ khÃ´ng cÃ³ target

**Steps:**
1. Má»Ÿ form cho Ä‘Æ¡n vá»‹ Ä‘Ã£ cÃ³ target = 0
2. **Expected**: Checkbox tá»± Ä‘á»™ng Ä‘Æ°á»£c check
3. Input chá»‰ tiÃªu tá»± Ä‘á»™ng áº©n
4. Actual value hiá»ƒn thá»‹ giÃ¡ trá»‹ cÅ©

### Test Case 4: Validation khi khÃ´ng cÃ³ target

**Steps:**
1. Check "KhÃ´ng giao CT"
2. Äá»ƒ trá»‘ng actual
3. Click "LÆ°u Ä‘iá»ƒm"
4. **Expected**: Hiá»ƒn thá»‹ lá»—i "Vui lÃ²ng nháº­p káº¿t quáº£ thá»±c hiá»‡n"

---

## ğŸ”„ TÆ°Æ¡ng thÃ­ch

- âœ… TÆ°Æ¡ng thÃ­ch vá»›i dá»¯ liá»‡u cÅ© (target > 0)
- âœ… Auto-detect Ä‘Æ¡n vá»‹ khÃ´ng cÃ³ target (target = 0)
- âœ… KhÃ´ng áº£nh hÆ°á»Ÿng cÃ¡c tiÃªu chÃ­ khÃ¡c (type 2, 3, 4)
- âœ… Responsive trÃªn mobile

---

## ğŸ“ LÆ°u Ã½ quan trá»ng

1. **Checkbox chá»‰ cÃ³ cho tiÃªu chÃ­ Ä‘á»‹nh lÆ°á»£ng (type=1)**
   - TiÃªu chÃ­ Ä‘á»‹nh tÃ­nh, cháº¥m tháº³ng, cá»™ng/trá»« khÃ´ng cÃ³ checkbox nÃ y

2. **KhÃ´ng thá»ƒ preview Ä‘iá»ƒm khi khÃ´ng cÃ³ target**
   - VÃ¬ cáº§n so sÃ¡nh vá»›i cÃ¡c Ä‘Æ¡n vá»‹ khÃ¡c trong nhÃ³m
   - Äiá»ƒm sáº½ Ä‘Æ°á»£c tÃ­nh tá»± Ä‘á»™ng sau khi lÆ°u

3. **Badge "KhÃ´ng giao CT" hiá»ƒn thá»‹ trÃªn báº£ng Ä‘iá»ƒm**
   - GiÃºp phÃ¢n biá»‡t Ä‘Æ¡n vá»‹ khÃ´ng cÃ³ target vá»›i cÃ¡c Ä‘Æ¡n vá»‹ khÃ¡c
   - Xem tÃ i liá»‡u `SCORING_NO_TARGET_UNITS.md` Ä‘á»ƒ hiá»ƒu cÃ¡ch tÃ­nh Ä‘iá»ƒm

4. **CÃ³ thá»ƒ chuyá»ƒn Ä‘á»•i giá»¯a cÃ³/khÃ´ng target**
   - Check/uncheck checkbox báº¥t cá»© lÃºc nÃ o trÆ°á»›c khi lÆ°u
   - Dá»¯ liá»‡u cÅ© sáº½ Ä‘Æ°á»£c giá»¯ láº¡i khi uncheck

---

## ğŸ“ Best Practices

### **Cho ngÆ°á»i dÃ¹ng:**
1. **Äá»c ká»¹ mÃ´ táº£** bÃªn dÆ°á»›i checkbox trÆ°á»›c khi check
2. **Äáº£m báº£o Ä‘Æ¡n vá»‹ thá»±c sá»± khÃ´ng Ä‘Æ°á»£c giao** chá»‰ tiÃªu
3. **Nháº­p káº¿t quáº£ chÃ­nh xÃ¡c** vÃ¬ Ä‘iá»ƒm phá»¥ thuá»™c vÃ o so sÃ¡nh vá»›i Ä‘Æ¡n vá»‹ khÃ¡c

### **Cho admin:**
1. **ThÃ´ng bÃ¡o rÃµ** cho cÃ¡c Ä‘Æ¡n vá»‹ vá» cÃ¡ch cháº¥m Ä‘iá»ƒm khi khÃ´ng cÃ³ target
2. **Kiá»ƒm tra badge** trÃªn báº£ng Ä‘iá»ƒm Ä‘á»ƒ xÃ¡c nháº­n dá»¯ liá»‡u Ä‘Ãºng
3. **Tham kháº£o chÃº thÃ­ch** á»Ÿ cuá»‘i báº£ng Ä‘á»ƒ giáº£i thÃ­ch cho Ä‘Æ¡n vá»‹

---

## ğŸ“ Files liÃªn quan

- `client/src/components/ScoringModal.tsx` - Form cháº¥m Ä‘iá»ƒm
- `client/src/pages/EvaluationPeriods.tsx` - Hiá»ƒn thá»‹ badge trÃªn báº£ng
- `server/criteriaScoreService.ts` - Logic tÃ­nh Ä‘iá»ƒm backend
- `SCORING_NO_TARGET_UNITS.md` - TÃ i liá»‡u chi tiáº¿t vá» cÃ¡ch tÃ­nh Ä‘iá»ƒm
