# HÆ°á»›ng dáº«n sá»­ dá»¥ng BÃ¡o cÃ¡o tá»•ng há»£p

## Tá»•ng quan

Há»‡ thá»‘ng bÃ¡o cÃ¡o tá»•ng há»£p má»›i Ä‘Æ°á»£c thiáº¿t káº¿ Ä‘á»ƒ giáº£i quyáº¿t váº¥n Ä‘á» **báº£ng bÃ¡o cÃ¡o cÃ³ quÃ¡ nhiá»u tiÃªu chÃ­ khiáº¿n khÃ´ng thá»ƒ in vá»«a khá»• giáº¥y**.

### CÃ¡c tÃ­nh nÄƒng chÃ­nh:

1. **BÃ¡o cÃ¡o tá»•ng quan** - Hiá»ƒn thá»‹ Ä‘iá»ƒm tá»•ng há»£p theo nhÃ³m tiÃªu chÃ­
2. **BÃ¡o cÃ¡o chi tiáº¿t theo nhÃ³m** - Hiá»ƒn thá»‹ tiÃªu chÃ­ theo cá»™t dá»c vá»›i cáº¥u trÃºc cÃ¢y cha-con
3. **Xuáº¥t Excel Ä‘a sheet** - Má»—i nhÃ³m tiÃªu chÃ­ lÃ  má»™t sheet riÃªng
4. **TÃ¹y chá»n lá»c vÃ  in** - Cho phÃ©p tÃ¹y chá»‰nh ná»™i dung hiá»ƒn thá»‹

---

## CÃ¡ch sá»­ dá»¥ng

### 1. Truy cáº­p trang bÃ¡o cÃ¡o

Tá»« trang **BÃ¡o cÃ¡o** hiá»‡n táº¡i, nháº¥n nÃºt **"BÃ¡o cÃ¡o tá»•ng há»£p má»›i"** á»Ÿ gÃ³c trÃªn bÃªn pháº£i.

Hoáº·c truy cáº­p trá»±c tiáº¿p: `/reports/comprehensive`

### 2. Chá»n ká»³ thi Ä‘ua vÃ  cá»¥m

- Chá»n **Ká»³ thi Ä‘ua** tá»« dropdown
- Chá»n **Cá»¥m** (tá»± Ä‘á»™ng lá»c theo quyá»n cá»§a ngÆ°á»i dÃ¹ng)

### 3. TÃ¹y chá»n hiá»ƒn thá»‹

Báº¡n cÃ³ thá»ƒ báº­t/táº¯t cÃ¡c tÃ¹y chá»n sau:

- âœ… **Hiá»ƒn thá»‹ Ä‘iá»ƒm tá»± cháº¥m** (ÄTC)
- âœ… **Hiá»ƒn thá»‹ tháº©m Ä‘á»‹nh L1** (TÄ1)
- âœ… **Hiá»ƒn thá»‹ tháº©m Ä‘á»‹nh L2** (TÄ2)
- âœ… **áº¨n tiÃªu chÃ­ khÃ´ng phÃ¢n cÃ´ng** (KP)
- âœ… **áº¨n cá»™t trá»‘ng** (khÃ´ng cÃ³ Ä‘iá»ƒm)

### 4. Xem bÃ¡o cÃ¡o

#### Tab "Tá»•ng quan"

Hiá»ƒn thá»‹ báº£ng tá»•ng há»£p Ä‘iá»ƒm theo nhÃ³m tiÃªu chÃ­:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ ÄÆ¡n vá»‹       â”‚ NhÃ³m I  â”‚ NhÃ³m II â”‚ NhÃ³m IIIâ”‚ Tá»•ng    â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ ÄÆ¡n vá»‹ A     â”‚         â”‚         â”‚         â”‚         â”‚
â”‚   ÄTC        â”‚ 25.0    â”‚ 18.0    â”‚ 5.0     â”‚ 48.0    â”‚
â”‚   TÄ1        â”‚ 25.0    â”‚ 18.0    â”‚ 5.0     â”‚ 48.0    â”‚
â”‚   TÄ2        â”‚ -       â”‚ -       â”‚ -       â”‚ -       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Æ¯u Ä‘iá»ƒm:**
- Vá»«a khá»• giáº¥y A4 dá»c
- Dá»… so sÃ¡nh giá»¯a cÃ¡c Ä‘Æ¡n vá»‹
- ThÃ­ch há»£p cho bÃ¡o cÃ¡o nhanh

#### Tab "Chi tiáº¿t theo nhÃ³m"

Hiá»ƒn thá»‹ tiÃªu chÃ­ theo **cá»™t dá»c** vá»›i cáº¥u trÃºc cÃ¢y:

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚ TiÃªu chÃ­                       â”‚ ÄÆ¡n vá»‹ A  â”‚ ÄÆ¡n vá»‹ B  â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚ â— I. CÃ”NG TÃC Äáº¢NG (50Ä‘)      â”‚ 25.0      â”‚ -         â”‚
â”‚   â— 1. PhÃ¡t triá»ƒn ÄV (25Ä‘)    â”‚ 15.0      â”‚ -         â”‚
â”‚     â€¢ TC7: Sá»‘ lÆ°á»£ng ÄV (10Ä‘)   â”‚           â”‚           â”‚
â”‚       ÄTC: 10.0 | TÄ1: 10.0   â”‚           â”‚           â”‚
â”‚     â€¢ TC8: GiÃ¡o dá»¥c CT (5Ä‘)    â”‚           â”‚           â”‚
â”‚       ÄTC: 5.0 | TÄ1: 5.0     â”‚           â”‚           â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

**Æ¯u Ä‘iá»ƒm:**
- Thá»ƒ hiá»‡n rÃµ cáº¥u trÃºc cÃ¢y cha-con
- TiÃªu chÃ­ theo hÃ ng â†’ Vá»«a khá»• giáº¥y A4 ngang
- Dá»… Ä‘á»c tá»«ng tiÃªu chÃ­ chi tiáº¿t

**Chá»n nhÃ³m:**
- Máº·c Ä‘á»‹nh hiá»ƒn thá»‹ **"Táº¥t cáº£ nhÃ³m"**
- CÃ³ thá»ƒ chá»n **tá»«ng nhÃ³m** Ä‘á»ƒ in riÃªng

### 5. In bÃ¡o cÃ¡o

Nháº¥n nÃºt **"In bÃ¡o cÃ¡o"** â†’ Chá»n:
- **Khá»• giáº¥y:** A4 Landscape (ngang)
- **Margins:** Normal (1cm)

Há»‡ thá»‘ng sáº½ tá»± Ä‘á»™ng:
- áº¨n cÃ¡c nÃºt Ä‘iá»u khiá»ƒn
- áº¨n sidebar, header
- Tá»‘i Æ°u bá»‘ cá»¥c cho in

### 6. Xuáº¥t Excel

Nháº¥n nÃºt **"Xuáº¥t Excel"** â†’ Táº£i file Excel vá»›i cáº¥u trÃºc:

#### Sheet 1: "Tá»•ng quan"
- Báº£ng tá»•ng há»£p theo nhÃ³m tiÃªu chÃ­
- Dá»… xem overview nhanh

#### Sheet 2+: "NhÃ³m 1", "NhÃ³m 2", ...
- Má»—i nhÃ³m lÃ  má»™t sheet riÃªng
- Chi tiáº¿t Ä‘áº§y Ä‘á»§ cÃ¡c tiÃªu chÃ­
- Format vá»›i indent vÃ  kÃ½ hiá»‡u cÃ¢y (â—, â€¢)

**Æ¯u Ä‘iá»ƒm Excel:**
- CÃ³ thá»ƒ sao chÃ©p/phÃ¢n tÃ­ch dá»¯ liá»‡u
- Tá»± Ä‘á»™ng Ä‘iá»u chá»‰nh cá»™t
- Lá»c, sort theo Ã½ muá»‘n

---

## API Endpoints

### 1. BÃ¡o cÃ¡o tá»•ng quan

```
GET /api/reports/summary?periodId={id}&clusterId={id}
```

**Response:**
```json
{
  "period": {...},
  "cluster": {...},
  "units": [
    {
      "unitId": "...",
      "unitName": "...",
      "groups": [
        {
          "groupId": "...",
          "groupName": "...",
          "groupMaxScore": 50,
          "selfScore": 25.0,
          "clusterScore": 25.0,
          "finalScore": null
        }
      ],
      "totals": {
        "selfScore": 48.0,
        "clusterScore": 48.0,
        "finalScore": 0
      }
    }
  ],
  "criteriaGroups": [...]
}
```

### 2. BÃ¡o cÃ¡o chi tiáº¿t theo nhÃ³m

```
GET /api/reports/group-detail?periodId={id}&clusterId={id}&groupId={id}
```

**Query params:**
- `periodId` (required)
- `clusterId` (required)
- `groupId` (optional) - Náº¿u khÃ´ng truyá»n sáº½ tráº£ vá» táº¥t cáº£ nhÃ³m

**Response:**
```json
{
  "period": {...},
  "cluster": {...},
  "units": [...],
  "groups": [
    {
      "groupId": "...",
      "groupName": "...",
      "groupMaxScore": 50,
      "criteriaRows": [
        {
          "criteriaId": "...",
          "criteriaNumber": "1",
          "criteriaName": "...",
          "level": 1,
          "maxScore": 50,
          "isParent": true,
          "units": {
            "unit-id-1": {
              "isAssigned": true,
              "selfScore": 25.0,
              "clusterScore": 25.0,
              "finalScore": null
            }
          }
        }
      ]
    }
  ]
}
```

### 3. Xuáº¥t Excel

```
GET /api/reports/export-excel?periodId={id}&clusterId={id}
```

**Response:** File Excel binary

**Filename format:** 
`BaoCaoChiTiet_{ClusterName}_{PeriodName}_YYYY-MM-DD.xlsx`

---

## PhÃ¢n quyá»n

- **Admin:** Xem táº¥t cáº£ cá»¥m
- **Cluster Leader:** Chá»‰ xem cá»¥m cá»§a mÃ¬nh
- **User:** Chá»‰ xem cá»¥m cá»§a Ä‘Æ¡n vá»‹ mÃ¬nh

---

## Ká»¹ thuáº­t Implementation

### Backend (server/reportRoutes.ts)

- **Recursion:** Duyá»‡t cÃ¢y tiÃªu chÃ­ Ä‘á»ƒ tÃ­nh tá»•ng Ä‘iá»ƒm
- **Map-based lookup:** Tá»‘i Æ°u performance vá»›i Map
- **ExcelJS:** Táº¡o file Excel vá»›i format Ä‘áº¹p

### Frontend (ComprehensiveReports.tsx)

- **React Query:** Cache vÃ  refetch thÃ´ng minh
- **Tabs:** TÃ¡ch riÃªng Summary vÃ  Detail
- **Checkbox filters:** TÃ¹y chá»‰nh hiá»ƒn thá»‹
- **Print CSS:** Tá»± Ä‘á»™ng tá»‘i Æ°u khi in

### Print Styles (index.css)

```css
@media print {
  @page { size: A4 landscape; margin: 1cm; }
  .no-print { display: none !important; }
  /* ... auto optimize layout ... */
}
```

---

## Troubleshooting

### Váº¥n Ä‘á»: Báº£ng váº«n khÃ´ng vá»«a khi in

**Giáº£i phÃ¡p:**
1. Kiá»ƒm tra Ä‘Ã£ chá»n **A4 Landscape** chÆ°a
2. Báº­t tÃ¹y chá»n **"áº¨n cá»™t trá»‘ng"**
3. Chá»n in **tá»«ng nhÃ³m** thay vÃ¬ táº¥t cáº£
4. Xuáº¥t Excel Ä‘á»ƒ xem chi tiáº¿t

### Váº¥n Ä‘á»: KhÃ´ng táº£i Ä‘Æ°á»£c dá»¯ liá»‡u

**Kiá»ƒm tra:**
1. ÄÃ£ chá»n Ä‘Ãºng ká»³ thi Ä‘ua vÃ  cá»¥m chÆ°a
2. CÃ³ quyá»n xem cá»¥m Ä‘Ã³ khÃ´ng (Cluster Leader/User chá»‰ xem cá»¥m mÃ¬nh)
3. Kiá»ƒm tra console log lá»—i API

### Váº¥n Ä‘á»: Excel khÃ´ng xuáº¥t Ä‘Æ°á»£c

**Giáº£i phÃ¡p:**
1. Äá»£i táº£i hoÃ n táº¥t (file cÃ³ thá»ƒ lá»›n)
2. Kiá»ƒm tra popup blocker
3. Thá»­ láº¡i vá»›i Ã­t nhÃ³m hÆ¡n

---

## Best Practices

### Khi nÃ o dÃ¹ng Tá»•ng quan?
- Há»p nhanh, bÃ¡o cÃ¡o sÆ¡ bá»™
- So sÃ¡nh tá»•ng Ä‘iá»ƒm giá»¯a cÃ¡c Ä‘Æ¡n vá»‹
- In nhanh 1 trang

### Khi nÃ o dÃ¹ng Chi tiáº¿t theo nhÃ³m?
- Kiá»ƒm tra chi tiáº¿t tá»«ng tiÃªu chÃ­
- LÆ°u há»“ sÆ¡ chÃ­nh thá»©c
- Äá»‘i chiáº¿u Ä‘iá»ƒm

### Khi nÃ o xuáº¥t Excel?
- Cáº§n phÃ¢n tÃ­ch thÃªm (pivot, chart)
- Chia sáº» file cho nhiá»u ngÆ°á»i
- LÆ°u trá»¯ lÃ¢u dÃ i

---

## Changelog

### Version 1.0.0 (2025-11-26)

âœ¨ **Features:**
- BÃ¡o cÃ¡o tá»•ng quan theo nhÃ³m
- BÃ¡o cÃ¡o chi tiáº¿t vá»›i cáº¥u trÃºc cÃ¢y
- Xuáº¥t Excel Ä‘a sheet
- TÃ¹y chá»n lá»c hiá»ƒn thá»‹
- Responsive print layout

ğŸ¨ **Design:**
- Bá»‘ cá»¥c dá»c cho tiÃªu chÃ­
- Indent vÃ  kÃ½ hiá»‡u cÃ¢y (â—, â€¢)
- Tá»‘i Æ°u in A4 ngang

ğŸ”’ **Security:**
- PhÃ¢n quyá»n theo role
- Validate periodId, clusterId

---

## LiÃªn há»‡ há»— trá»£

Náº¿u gáº·p váº¥n Ä‘á» hoáº·c cáº§n há»— trá»£, vui lÃ²ng liÃªn há»‡ team phÃ¡t triá»ƒn.
